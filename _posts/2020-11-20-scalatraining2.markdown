---
layout: post
title:  "Scalaå…¥é—¨åŸ¹è®­ï¼šforå¾ªç¯"
date:   2020-11-05 11:00:00 +0000
categories: [Scala]
excerpt: "ã€‚ã€‚ã€‚"
hidden: true
---

ç¬¬ä¸€ä¸ªScalaæ•™ç¨‹ç»“æŸä¹‹åï¼Œæˆ‘è§‰å¾—å¤§å®¶å¯¹`for`å¾ªç¯å’Œ`map`ã€`flatMap`ã€`filter`çš„å…³ç³»è¿˜æœ‰ç‚¹æ¨¡ç³Šã€‚å…¶å®ï¼Œæˆ‘ä¹Ÿè§‰å¾—å¤§å®¶ä¸ååˆ†æ¸…æ¥š`map`ã€`flatMap`ã€`filter`åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„å‡½æ•°ï¼Œä¸å¤ªäº†è§£å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€‚ç„¶è€Œï¼Œå¤§å®¶ç†Ÿæ‚‰å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ï¼Œå› æ­¤å‡½æ•°å¼çš„å˜æ¢/æ˜ å°„ã€æ»¤é™¤æ¯”è¾ƒéš¾å­¦çš„ã€‚æˆ‘å¸Œæœ›äº†çœ‹ä¸‹é¢çš„å›¾ä¼šè§£é‡Šä¸€åˆ‡ã€‚

![](/assets/2020-11-20-scalatraining2/fmfm.png)

å¾ˆæ˜æ˜¾çš„ï¼Œç¬¬ä¸€ä¸ªæ“ä½œæ˜¯æ»¤é™¤â€”â€”`filter`ã€ç¬¬äºŒä¸ªæ˜¯æ˜ å°„â€”â€”`map`ã€ç¬¬ä¸‰ä¸ªæ˜¯`flatMap`ã€‚å³ä½¿æˆ‘æ²¡æŠŠå˜é‡çš„ç±»å‹å®šä¹‰å¥½ï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡º`a`å’Œ`A`éƒ½æ˜¯ä¸€ç§æ•°ç»„ï¼Œæ›´ç¡®åˆ‡åœ°è¯´å¯ä»¥ä»å¤´åˆ°å°¾æŠŠæ¯ä¸€ä¸ªå…ƒç´ éƒ½è¯»å–ï¼Œå³Scalaæ‰€å®šä¹‰`Iterable[+A]`çš„å­ç±»ã€‚é‚£ä¹ˆï¼Œä»æ¥æ²¡é‡åˆ°å‡½æ•°å¼çš„ç¼–ç¨‹è¯­è¨€çš„äººä¼šæ€ä¹ˆç†è§£è¿™ä¸‰ä¸ªå‡½æ•°å‘¢ï¼Ÿæˆ‘ä»¥ä¸ºä¸Šé¢çš„å›¾æ ‡å¤ªæ˜æ˜¾çš„ï¼Œå¹¶ä¸éœ€è¦è¡¥å……è§£é‡Šï¼›å¤§å®¶ç«Ÿç„¶ä¸äº†è§£`map`ã€`flatMap`ã€`filter`å‚æ•°çš„ç±»å‹è¦æ±‚ï¼Œä¹Ÿä¸å¤ªæ¸…æ¥šè¿”å›å€¼æ˜¯æ€ä¹ˆç®—å‡ºçš„ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬æ˜¯ä»æ™®éJavaä»£ç å¼€å§‹çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥è·‘åˆ°ç®€æ´`List(1, 2, 3, ...).map(...)`çš„ã€‚

{% highlight Java linenos %}
private boolean f3(int input) {
    return i > 3;
}

private int f2(int input) {
    return input * 10;
}

private List<Integer> f3(int input) {
    return Arrays.asList(input, input * 10);
}

...

List<Integer> numbers    = ... // æ¯”å¦‚ { 1, 2, 3, 4, 5 };
List<Integer> filtered   = new ArrayList<>();
List<Integer> mapped     = new ArrayList<>();
List<Integer> flatMapped = new ArrayList<>();
for (Integer n : numbers) {
    final boolean accept             = f1(n);
    final int mappedValue            = f2(n);
    final List<Integer> mappedValues = f3(n);

    if (accept) filtered.add(n);
    mapped.add(mappedValue);
    for (Integer fm : mappedValues) flatMapped.add(fm);
}
// filteredç­‰äº"ArrayList { 4, 5 }"
// mappedç­‰äº"ArrayList { 10, 20, 30, 40, 50 }"
// flatMappedç­‰äº"ArrayList { 1ï¼Œ 10, 2ï¼Œ 20, 3ï¼Œ 30, 4ï¼Œ 40, 5ï¼Œ 50 }"
{% endhighlight %}

ä¸Šé¢çš„ä»£ç æ˜¯å¾ˆå®¹æ˜“äº†è§£çš„ï¼Œè€Œä¸”æ˜¯å¤§å­¦CSæ•™ç¨‹ä¸­å¾ˆå¸¸è§çš„ä»£ç ã€‚æ¯ä¸€ä¸ªå‘½ä»¤éƒ½å¾ˆæ˜æ˜¾åœ°è¡¨ç¤ºå®ƒçš„ç›®çš„ï¼Œå¾ˆæ˜æ˜¾åœ°è¡¨ç¤ºå®ƒçš„è¾“å…¥ã€è¾“å‡ºï¼›è™½ç„¶æœ‰ç‚¹å•°å—¦ï¼Œä½†æ˜¯å®¹æ˜“äº†è§£ã€‚åªä¸è¿‡å¤§éƒ¨åˆ†çš„Scalaæºç æ‰€ä½¿ç”¨ä¸æ˜¯ä¸Šè¿°çš„å‘½ä»¤å¼çš„æ–¹æ³•ï¼Œè€Œä½¿ç”¨å‡½æ•°å¼çš„æ–¹æ³•ã€‚`filter`ã€`map`ã€`flatMap`çš„æ¦‚å¿µè™½ç„¶å¾ˆå®¹æ˜“äº†è§£ï¼Œä½†æ˜¯å®ç°æ—¶é‡åˆ°äº›é—®é¢˜ã€‚å­¦ä¼šäº†åŸºæœ¬çš„æ¦‚å¿µã€ç®—æ³•è¿‡åï¼Œä¸‹ä¸€æ­¥è¦å­¦ä¹ å“ªäº›ç±»å‹åŒ…æ‹¬ä¸Šè¿°çš„ç‰¹æ®Šå‡½æ•°ï¼Œè€Œä¸”è¿™ä¸‰ä¸ªå‡½æ•°çš„å…·ä½“ç”¨é€”æ˜¯ä»€ä¹ˆã€‚æœ€å¸¸è§ç±»å‹æ˜¯`Option`ã€`List`ã€`Either`ï¼Œå› æ­¤æˆ‘ä»¬æ˜¯ä»è¿™ä¸‰ä¸ªå…·ä½“ç±»å‹å¼€å§‹å­¦ä¹ çš„ã€‚ä¸‹é¢çš„å›¾æ‰€è§£é‡Šçš„æ˜¯*å…·ä½“*`map`å’Œ`flatMap`çš„ç”¨æ³•ã€‚

![](/assets/2020-11-20-scalatraining2/fmfmt.png)

è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿å›¾ä¸Šæ˜¯æŠŠå®Œå…¨ä¸åŒçš„ç±»å‹æ ‘ï¼ˆ`IterableOps`çš„å­ç±»`Option`ã€`List`è·Ÿ`Either`ï¼‰æ··åˆèµ·æ¥ï¼›è™½ç„¶ä¸å‡†ç¡®ï¼Œä½†ç†ç”±æ˜¯ä»”ç»†åœ°è¯´æ˜è¿™ä¸‰ä¸ªåˆåŸºç¡€åˆå¸¸è§çš„å‡½æ•°çš„ç›®çš„å’Œç”¨æ³•ã€‚å³ä½¿ç»§æ‰¿çš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œ`map`å’Œ`flatMap`çš„ç”¨æ³•ä¹Ÿå®Œå…¨ä¸€è‡´ï¼šä¸€æ—¦ç†Ÿæ‚‰ï¼Œå¤§å®¶å°±å‡­ç›´è§‰çŸ¥é“æ€ä¹ˆç”¨ã€‚å› ä¸º`List`ã€`Option`ã€`Either`éƒ½æ˜¯ä¸€ç§å®¹å™¨ã€éƒ½å¥½åƒæ˜¯ç”±ä¸¤ä¸ªæ¡ˆä¾‹ç±»[^1]è€Œå®šä¹‰çš„ï¼Œä¸Šé¢çš„å›¾è¿˜æ‰€ç¤ºçš„æ˜¯`fold`ï¼›æˆ‘è¦å¼ºè°ƒçš„â€œå®¹å™¨æ€§â€œâ€”â€”`Option`ã€`List`ã€`Either`éƒ½å¹¶ä¸æ˜¯å•å€¼ï¼Œè¦æŠŠå®ƒä»¬å˜æ¢æˆå•å€¼æ—¶å¿…é¡»ç®¡ç†æ‰€æœ‰å¯èƒ½çš„å®¹å™¨å€¼ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠå®¹å™¨çš„ä¸¤ä¸ªæ¡ˆä¾‹å€¼`fold`æˆä¸€ä¸ªå€¼ã€‚

## `for`å¾ªç¯
{% highlight Scala linenos %}
val maybeInt: Option[Int] = Some(1)
val listInt: List[Int] = List(1, 2, 3, 4, 5)

val _ for {
  int <- maybeInt
} yield int * 2

val _ = for {
  int <- maybeInt
  if int > 10
} yield int * 2

val _ = for {
  a <- listInt
  b <- listInt
  if a < 5 && b > 1
} yield a * b
{% endhighlight %}

{% highlight Scala linenos %}
maybeInt.withFilter(int => int > 10).map(int => int * 2)

listInt.flatMap(a => listInt.withFilter(b => b > 1 && a < 5).map(b => a * b))
{% endhighlight %}

[^1]: Haskellã€MLæŠŠè¯¥ç»“æ„å«åšä»£æ•°æ•°æ®ç»“æ„ï¼ŒHaskellã€MLéƒ½ç”¨æ¯”è¾ƒç®€æ´å¥æ³•æ¥å®šä¹‰ä»£æ•°æ•°æ®ç»“æ„ï¼Œå¯¹æ¯”ä¸€ä¸‹`sealed trait O[+A]; case class S[A](a: A) extends O[A]; case object N extends O[Nothing]`å’Œ`data O a = S a | N`ã€‚

<!--
ä¸”ååˆ†æ­£å¸¸ã€‚å¯¹å§ï¼Ÿå‘µå‘µï¼Œå¾—çœ‹æƒ…å†µï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œåœ¨å¤šçº¿æƒ…å†µä¸‹ä¸Šé¢çš„ä»£ç ä¼šå‡ºrace conditionã€‚è¯¥race conditionä¼šè¢«`numbers`æ•°ç»„åŒæ—¶å˜ã€è¯»å–å¼•èµ·çš„ã€‚é‚£ä¹ˆï¼ŒJavaåŒ…æ‹¬ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å…³é”®è¯ï¼Œå³`final`ã€‚å¤§å®¶éƒ½çŸ¥é“å®šä¹‰ä¸º`final`ä»£è¡¨ç€å˜é‡çš„å€¼æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆä¸å¯å˜çš„å˜é‡æ€ä¹ˆèƒ½è°ƒç”¨ç±»ä¼¼äº`add`çš„å‡½æ•°å‘¢ï¼Ÿå…¶å®ï¼Œåœ¨Javaï¼Œæ›´æ­£ç¡®åœ°è¯´JVMï¼ŒæŠŠ`final`å®šä¹‰ä¸ºâ€œæŒ‡é’ˆâ€æ˜¯ä¸å¯å˜çš„ï¼Œè€ŒæŒ‡é’ˆæ‰€æŒ‡çš„å®ä¾‹ä¸æ˜¯å› ä¸º`final`è€Œå—åˆ°ä»»ä½•é™åˆ¶çš„ã€‚

{% highlight Java linenos %}
final List<Integer> numbers    = Arrays.asList(1, 2, 3, 4, 5);
final List<Integer> filtered   = new ArrayList<>();
final List<Integer> mapped     = new ArrayList<>();
final List<Integer> flatMapped = new ArrayList<>();

// è™½ç„¶å®šä¹‰ä¸ºfinalï¼Œè¿˜èƒ½è°ƒç”¨`add`æ–¹æ³•
{% endhighlight %}

è¿™é‡Œè¦å¯¹æ¯”ä¸€ä¸‹C++æ‰€å¸¦æ¥çš„`const`ã€‚C++çš„`const`ç¡®å®æ˜¯ä»£è¡¨ç€å¸¸æ•°ã€ä¸å¯å˜çš„å€¼ã€‚

{% highlight Java linenos %}
const std::vector<int> numbers = { 1, 2, 3, 4, 5 };
numbers.push_back(6);   // ç¼–è¯‘æ—¶æŠ¥é”™ï¼š*const* std::vector<int> ä¸åŒ…å«ç€push_backå‡½æ•°
{% endhighlight %}

ä¸ºä»€ä¹ˆè¦è°ˆè°ˆ`final`ã€ä¸å¯å˜çš„å˜é‡å‘¢ï¼Ÿå› ä¸ºå¯ä»¥æŠŠ`final`ç›´æ¥ç¿»è¯‘åˆ°Scalaçš„`val`ã€‚æˆ‘å¼ºçƒˆæ¨èå¤§å®¶éƒ½å°½é‡ä½¿ç”¨`val`ï¼›é€šè¿‡`val`å¯ä»¥å†™æ›´å®¹æ˜“äº†è§£çš„ä»£ç ï¼Œä¸€æ—¦æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªå®šä¹‰ä¸º`val`çš„å˜é‡èµ‹å€¼å¥½ï¼Œå˜é‡çš„å€¼ä¸ä¼šè¢«æ”¹å˜çš„ã€‚æŠŠæ‰€æœ‰çš„å˜é‡éƒ½å®šä¹‰ä¸º`val`ï¼Œä¸€æ—¦æœ‰ä¸€å®šçš„å€¼ï¼Œæˆ‘ä»¬ç¡®å®šå®ƒçš„å€¼ä¸ä¼šå†å˜ã€‚å¯æƒœï¼Œåœ¨JVMè¯­è¨€ä¸­ï¼Œ`final`æœ¬èº«ä¸èƒ½ä¿è¯ä¸å¯å˜æ€§ã€‚å› ä¸ºä¸Šé¢æè¿°çš„`final`è§„åˆ™ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»ä¾èµ–ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚

é€šè¿‡æŸä¸€ä¸ªç®—æ³• ğ‘“ æŠŠæ¯ä¸€ä¸ªå…ƒç´ æ˜ å°„å¦å¤–ä¸€ä¸ªå…ƒç´ 

é€šè¿‡æŸä¸€ä¸ªç®—æ³• ğ‘“ æŠŠæ¯ä¸€ä¸ªå…ƒç´ æ˜ å°„å¦å¤–ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæŠŠè¿”å›çš„æ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ æ·»åŠ äºç»“æœ
-->

# ä¸‰ã€é«˜é˜¶Scala

# å››ã€æé«˜é˜¶Scala

# äº”ã€æ€»ç»“
- ğŸ˜ æ¨¡å¼åŒ¹é…
- ğŸ™ æ³›å‹ç±»ã€åŒ…æ‹¬æ ‡å‡†åº“ä¸­`List`ã€`Option`ï¼›æ ‡å‡†åº“çš„å¸¸ç”¨æ–¹æ³•`map`ã€`flatMap`ã€`filter`
- â˜¹ï¸ æœ‰ç€ä¸¤ä¸ªï¼ˆä»¥ä¸Šï¼‰ç±»å‹å‚æ•°çš„æ³›å‹ç±»ã€æ¯”å¦‚æ ‡å‡†åº“ä¸­`Either`
- ğŸ˜¬ `for`ï¼ŒåŒ…æ‹¬`for`è·Ÿ`map`ã€`flatMap`ã€`filter`çš„å…³ç³»
- ğŸ¤¬ Pimp my libraryã€implicits

![](/assets/2020-11-03-intro/http4s-intro.png)

<!---
æœ‰æ—¶å€™æœ‰äººé—®æˆ‘â€œæˆ‘å¾ˆæƒ³å­¦ä¹ ä¸€é—¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚Scalaï¼›æˆ‘åº”è¯¥æ€ä¹ˆæ ·æœ€å¥½å¼€å§‹è¿™ä¸ªè¿‡ç¨‹ï¼Ÿâ€ã€‚ä¸ä¹…ä»¥å‰æˆ‘åªæœ‰ä¸€ä¸ªæ¨èï¼šä¸€è¾¹è¯»ä¸€æœ¬ä¹¦ï¼ˆæ¯”å¦‚Scala for the impatientæˆ–è€…XXXï¼‰ï¼Œä¸€è¾¹åœ¨ä¸€ä¸ªå°é¡¹ç›®å®ç°åˆšåˆšå­¦çš„å†…å®¹ã€‚â€œå¤ªè°¢è°¢ä½ äº†â€ï¼Œä¸€èˆ¬æ˜¯æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¥ä¸ºä»–ä»¬å¼€å§‹è‡ªå·±çš„å†ç¨‹ï¼Œæ²¡æœ‰ä»»ä½•å†è¦é—®çš„é—®é¢˜ã€‚æˆ‘ä¸€ç›´ä»¥ä¸ºScalaæ˜¯å¥½å¥½å­¦çš„è¯­è¨€ï¼ŒGitHubä¸Šé¢å……æ»¡ç€å¤„ç†å„ç§å„æ ·çš„å¼€æºçš„é¡¹ç›®ï¼Œæˆ‘ä»¥ä¸ºæ–‡æ¡£å¤ªç¹è£äº†ï¼Œåªè¦ä¸“å¿ƒäºå­¦ä¹ ï¼Œ

ä¸ºäº†å¥½å¥½å­¦ä¹ Scalaã€Haskellç­‰ç­‰å‡½æ•°å¼è¯­è¨€æˆ‘ä»¬å…ˆè¦å¥½å¥½å­¦ä¹ ä»€ä¹ˆæ˜¯å‡½æ•°ï¼Œä»€ä¹ˆæŠŠå®ƒå¥½å¥½åˆ©ç”¨ï¼›ä¸€æ—¦å®Œå…¨äº†è§£å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„å…³é”®æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Œç«‹åˆ»è·‘åˆ°ä»”ç»†åœ°å­¦ä¹ æ ‡å‡†åº“çš„æœºæ„ã€æ•°æ®ç±»å‹ã€æ ‡å‡†å‡½æ•°ç­‰ç­‰ã€‚


# äºŒã€â€œHelloï¼Œ worldâ€ã€æ ‡å‡†åº“â€¦â€¦ ç„¶åå‘¢ï¼Ÿ


å¤§å®¶éƒ½çŸ¥é“æœ€åŸºæœ¬çš„ç¨‹åºå’Œå¤§å‹çš„ç¨‹åºçš„å·®åˆ«å¾ˆå¤§å¾ˆå¤§


æˆ‘è®¤ä¸ºScalaï¼ŒHaskellä¸–ç•Œä¸­çš„æœ€å¤§çš„é—®é¢˜å°±æ˜¯æ€ä¹ˆæŠŠä¸Šè¿°çš„è¿‡ç¨‹åº”ç”¨äºå»ºç«‹æœ‰ç”¨çš„ç¨‹åºã€‚
--->