---
layout: post
title:  "Scalaå…¥é—¨åŸ¹è®­ï¼šforå¾ªç¯"
date:   2020-11-05 11:00:00 +0000
categories: [Scala]
excerpt: "ã€‚ã€‚ã€‚"
hidden: true
---

ç¬¬ä¸€ä¸ªScalaæ•™ç¨‹ç»“æŸä¹‹åï¼Œæˆ‘è§‰å¾—å¤§å®¶å¯¹`for`å¾ªç¯å’Œ`map`ã€`flatMap`ã€`filter`çš„å…³ç³»è¿˜æœ‰ç‚¹æ¨¡ç³Šã€‚å…¶å®ï¼Œæˆ‘ä¹Ÿè§‰å¾—å¤§å®¶ä¸ååˆ†æ¸…æ¥š`map`ã€`flatMap`ã€`filter`åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„å‡½æ•°ï¼Œä¸å¤ªäº†è§£å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€‚ç„¶è€Œï¼Œå¤§å®¶ç†Ÿæ‚‰å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ï¼Œå› æ­¤å‡½æ•°å¼çš„å˜æ¢/æ˜ å°„ã€æ»¤é™¤æ¯”è¾ƒéš¾å­¦çš„ã€‚æˆ‘å¸Œæœ›äº†çœ‹ä¸‹é¢çš„å›¾ä¼šè§£é‡Šä¸€åˆ‡ã€‚

![](/assets/2020-11-20-scalatraining2/fmfm.png)

å¾ˆæ˜æ˜¾çš„ï¼Œç¬¬ä¸€ä¸ªæ“ä½œæ˜¯æ»¤é™¤â€”â€”`filter`ã€ç¬¬äºŒä¸ªæ˜¯æ˜ å°„â€”â€”`map`ã€ç¬¬ä¸‰ä¸ªæ˜¯`flatMap`ã€‚å³ä½¿æˆ‘æ²¡æŠŠå˜é‡çš„ç±»å‹å®šä¹‰å¥½ï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡º`a`å’Œ`A`éƒ½æ˜¯ä¸€ç§æ•°ç»„ï¼Œæ›´ç¡®åˆ‡åœ°è¯´å¯ä»¥ä»å¤´åˆ°å°¾æŠŠæ¯ä¸€ä¸ªå…ƒç´ éƒ½è¯»å–ï¼Œå³Scalaæ‰€å®šä¹‰`Iterable[+A]`çš„å­ç±»ã€‚é‚£ä¹ˆï¼Œä»æ¥æ²¡é‡åˆ°å‡½æ•°å¼çš„ç¼–ç¨‹è¯­è¨€çš„äººä¼šæ€ä¹ˆç†è§£è¿™ä¸‰ä¸ªå‡½æ•°å‘¢ï¼Ÿæˆ‘ä»¥ä¸ºä¸Šé¢çš„å›¾æ ‡å¤ªæ˜æ˜¾çš„ï¼Œå¹¶ä¸éœ€è¦è¡¥å……è§£é‡Šï¼›å¤§å®¶ç«Ÿç„¶ä¸äº†è§£`map`ã€`flatMap`ã€`filter`å‚æ•°çš„ç±»å‹è¦æ±‚ï¼Œä¹Ÿä¸å¤ªæ¸…æ¥šè¿”å›å€¼æ˜¯æ€ä¹ˆç®—å‡ºçš„ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬æ˜¯ä»æ™®éJavaä»£ç å¼€å§‹çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥è·‘åˆ°ç®€æ´`List(1, 2, 3, ...).map(...)`çš„ã€‚

{% highlight Java linenos %}
private boolean f3(int input) {
    return i > 3;
}

private int f2(int input) {
    return input * 10;
}

private List<Integer> f3(int input) {
    return Arrays.asList(input, input * 10);
}

...

List<Integer> numbers    = ... // æ¯”å¦‚ { 1, 2, 3, 4, 5 };
List<Integer> filtered   = new ArrayList<>();
List<Integer> mapped     = new ArrayList<>();
List<Integer> flatMapped = new ArrayList<>();
for (Integer n : numbers) {
    final boolean accept             = f1(n);
    final int mappedValue            = f2(n);
    final List<Integer> mappedValues = f3(n);

    if (accept) filtered.add(n);
    mapped.add(mappedValue);
    for (Integer fm : mappedValues) flatMapped.add(fm);
}
// filteredç­‰äº"ArrayList { 4, 5 }"
// mappedç­‰äº"ArrayList { 10, 20, 30, 40, 50 }"
// flatMappedç­‰äº"ArrayList { 1ï¼Œ 10, 2ï¼Œ 20, 3ï¼Œ 30, 4ï¼Œ 40, 5ï¼Œ 50 }"
{% endhighlight %}

ä¸Šé¢çš„ä»£ç æ˜¯å¾ˆå®¹æ˜“äº†è§£çš„ï¼Œè€Œä¸”æ˜¯å¤§å­¦CSæ•™ç¨‹ä¸­å¾ˆå¸¸è§çš„ä»£ç ã€‚æ¯ä¸€ä¸ªå‘½ä»¤éƒ½å¾ˆæ˜æ˜¾åœ°è¡¨ç¤ºå®ƒçš„ç›®çš„ï¼Œå¾ˆæ˜æ˜¾åœ°è¡¨ç¤ºå®ƒçš„è¾“å…¥ã€è¾“å‡ºï¼›è™½ç„¶æœ‰ç‚¹å•°å—¦ï¼Œä½†æ˜¯å®¹æ˜“äº†è§£ã€‚åªä¸è¿‡å¤§éƒ¨åˆ†çš„Scalaæºç æ‰€ä½¿ç”¨ä¸æ˜¯ä¸Šè¿°çš„å‘½ä»¤å¼çš„æ–¹æ³•ï¼Œè€Œä½¿ç”¨å‡½æ•°å¼çš„æ–¹æ³•ã€‚`filter`ã€`map`ã€`flatMap`çš„æ¦‚å¿µè™½ç„¶å¾ˆå®¹æ˜“äº†è§£ï¼Œä½†æ˜¯å®ç°æ—¶é‡åˆ°äº›é—®é¢˜ã€‚å­¦ä¼šäº†åŸºæœ¬çš„æ¦‚å¿µã€ç®—æ³•è¿‡åï¼Œä¸‹ä¸€æ­¥è¦å­¦ä¹ å“ªäº›ç±»å‹åŒ…æ‹¬ä¸Šè¿°çš„ç‰¹æ®Šå‡½æ•°ï¼Œè€Œä¸”è¿™ä¸‰ä¸ªå‡½æ•°çš„å…·ä½“ç”¨é€”æ˜¯ä»€ä¹ˆã€‚æœ€å¸¸è§ç±»å‹æ˜¯`Option`ã€`List`ã€`Either`ï¼Œå› æ­¤æˆ‘ä»¬æ˜¯ä»è¿™ä¸‰ä¸ªå…·ä½“ç±»å‹å¼€å§‹å­¦ä¹ çš„ã€‚ä¸‹é¢çš„å›¾æ‰€è§£é‡Šçš„æ˜¯*å…·ä½“*`map`å’Œ`flatMap`çš„ç”¨æ³•ã€‚

![](/assets/2020-11-20-scalatraining2/fmfmt.png)

è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿å›¾ä¸Šæ˜¯æŠŠå®Œå…¨ä¸åŒçš„ç±»å‹æ ‘ï¼ˆ`IterableOps`çš„å­ç±»`Option`ã€`List`è·Ÿ`Either`ï¼‰æ··åˆèµ·æ¥ï¼›è™½ç„¶ä¸å‡†ç¡®ï¼Œä½†ç†ç”±æ˜¯ä»”ç»†åœ°è¯´æ˜è¿™ä¸‰ä¸ªåˆåŸºç¡€åˆå¸¸è§çš„å‡½æ•°çš„ç›®çš„å’Œç”¨æ³•ã€‚å³ä½¿ç»§æ‰¿çš„ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œ`map`å’Œ`flatMap`çš„ç”¨æ³•ä¹Ÿå®Œå…¨ä¸€è‡´ï¼šä¸€æ—¦ç†Ÿæ‚‰ï¼Œå¤§å®¶å°±å‡­ç›´è§‰çŸ¥é“æ€ä¹ˆç”¨ã€‚å› ä¸º`List`ã€`Option`ã€`Either`éƒ½æ˜¯ä¸€ç§å®¹å™¨ã€éƒ½å¥½åƒæ˜¯ç”±ä¸¤ä¸ªæ¡ˆä¾‹ç±»[^1]è€Œå®šä¹‰çš„ï¼Œä¸Šé¢çš„å›¾è¿˜æ‰€ç¤ºçš„æ˜¯`fold`ï¼›æˆ‘è¦å¼ºè°ƒçš„â€œå®¹å™¨æ€§â€œâ€”â€”`Option`ã€`List`ã€`Either`éƒ½å¹¶ä¸æ˜¯å•å€¼ï¼Œè¦æŠŠå®ƒä»¬å˜æ¢æˆå•å€¼æ—¶å¿…é¡»ç®¡ç†æ‰€æœ‰å¯èƒ½çš„å®¹å™¨å€¼ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠå®¹å™¨çš„ä¸¤ä¸ªæ¡ˆä¾‹å€¼`fold`æˆä¸€ä¸ªå€¼ã€‚

## `for`å¾ªç¯
é¦–å…ˆï¼Œæˆ‘ä»¬æ¢è®¨â€œä¼ ç»Ÿâ€çš„ç¼–ç¨‹è¯­è¨€ä¸­çš„`for`å¾ªç¯ã€‚ä¸€å¦‚æ‰€æ–™ï¼Œç¼–è¯‘å™¨å°†`for`å¾ªç¯ç¼–è¯‘æˆï¼ˆç”¨ç€Intel x86_64æ±‡ç¼–è¯­è¨€çš„å¥æ³•ï¼‰`mov, add, cmp, jne`â€”â€”åˆå§‹åŒ–ã€å¢é‡ã€å¯¹æ¯”ã€è·³è½¬â€”â€”çš„å‘½ä»¤é¡ºåºã€‚è¿™é‡Œæˆ‘ä»¬ä¸è€ƒè™‘ä¸€å®šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œä¾‹å¦‚å¾ªç¯å±•å¼€ã€SIMDå‘½ä»¤ç­‰ç­‰ï¼Œä¸»è¦çš„æ˜¯æ¢è®¨å¾ªç¯çš„æœ€åŸºæœ¬çš„åŸåˆ™ã€‚

{% highlight C++ linenos %}
for (int i = 0; i < 100; i++) {
    // A
    ...
} 
// B
{% endhighlight %}

{% highlight asm linenos %}
    xor     ebx, ebx    // int i = 0
.L1:                        // A
    ...
    add     ebx, 1      // i++
    cmp     ebx, 100    // temp = i == 100
    jne     .L1         // if (!temp) goto .L2
// B
{% endhighlight %}

é‚£ä¹ˆï¼Œä»åŸåˆ™çœ‹æ¥ï¼ŒJavaç¼–è¯‘å™¨è·ŸC++ç¼–è¯‘å™¨æ‰€ç”Ÿäº§çš„æœºå™¨å‘½ä»¤ä¸€è‡´ã€‚ä¸è¿‡é™¤åˆ«åœ¨äºJavaè™šæ‹Ÿæœºæ˜¯æ‰€è°“æ ˆå¼å™¨ï¼Œè€Œå…¶ä½™çš„å¤„ç†å™¨åŒ…æ‹¬x86_64ã€ARMã€AVRã€PICç­‰ç­‰éƒ½æ˜¯å¯„å­˜å™¨å¼ã€‚ä½ å¯ä»¥å°†æ ˆç†è§£ä¸ºâ€œæ— é™çš„â€ã€æœ‰åºçš„å¯„å­˜å™¨é›†åˆã€‚

{% highlight Java linenos %}
for (int i = 0; i < 100; i++) {
    // A
    ...
} 
// B
{% endhighlight %}

{% highlight asm linenos %}
    iconst_0            // 0                        | 
    istore_1            //                          | (local) i = 0
    iload_1             // 0                        | 
1:
    bipush 100          // 0, 100                   |
    if_icmpge 2 (+16)   //                          | if (100 >= 100) goto 2
    // A
    iinc 1 by 1         //                          | i++
    goto 1 (-16)        //                          | goto 1
2:  // B
{% endhighlight %}


<!--
{% highlight Rust linenos %}
for i in 0..100 {
    // A
    ...
}
{% endhighlight %}

{% highlight asm linenos %}
        xor     ebp, ebp            // i = 0
.L2:
        // A
        ...
        add     ebp, 1              // i++
        cmp     ebp, 100            // temp = i == 100
        jne     .L2                 // if (!temp) goto .L2
// B
{% endhighlight %}

{% highlight Rust linenos %}
for i in 0..<100 {
    // A
    ...
}
// B
{% endhighlight %}

{% highlight asm linenos %}
        xor     r12d, r12d          // i = 0
.L2:
        // A
        lea     r12, [r12 + 1]      // i++
        cmp     r12, 100            // temp = i == 100
        jne     .L2                 // if (!temp) goto .L2
// B
{% endhighlight %}
-->

æ— è®ºæ˜¯æ ˆå¼å¤„ç†å™¨è¿˜æ˜¯å¯„å­˜å™¨å¼å¤„ç†å™¨ï¼ŒåŸåˆ™ä¸Š`for`å¾ªç¯éƒ½ä¸€è‡´ã€‚é‚£ä¹ˆï¼ŒScalaçš„`for`å¾ªç¯å®Œå…¨ä¸åŒã€‚å®ƒç¡®å®å¹¶ä¸æ˜¯ä¸€ç§å¾ªç¯ï¼ŒScalaç¼–è¯‘å™¨ä»¥å¹¶ä¸ä¼šæŠŠå®ƒç¼–è¯‘æˆâ€œåˆå§‹åŒ–ã€å¢é‡ã€å¯¹æ¯”ã€è·³è½¬â€è¿™æ¡å‘½ä»¤é¡ºåºã€‚Scalaå°†`for`ç†è§£ä¸ºå¥æ³•ç³–ï¼Œç±»ä¼¼äºHaskellçš„`do`å¥æ³•ç³–ã€‚å› æ­¤ï¼ŒScalaç¼–è¯‘å™¨ä¼šå°†`for`ç¼–è¯‘æˆè°ƒç”¨`map`æˆ–è€…`foreach`ã€`flatMap`ã€`filter`æ–¹æ³•ã€‚

{% highlight Scala linenos %}
for (i <- 0 until 100) {
  // A
}
{% endhighlight %}

{% highlight asm linenos %}
    iconst_0            // 0                        |
    invokevirtual #67   //                          | intWrapper(0)
    bipush 100          // RichInt(0), 100          |
    invokevirtual #71   //                          | RichInt(0).until(100)
    invokedynamic #89   // Range(0, 100), #89-ret   |
    invokevirtual #95   //                          | Range(0, 100).foreach(I => Unit)
    ...                 // Unit

#67: scala.Predef.intWrapper (I)RichInt
#71: scala.runtime.RichInt.until (RichInt, Int)Range
#89: <anonymous> (I)V { // A }
#95: Range.foreach ((I)V)V
{% endhighlight %}

ä¹Ÿå°±æ˜¯è¯´`for (i <- 0 until 100) println(i)`ç¡®å®è¢«ç¼–è¯‘æˆ`intWrapper(0).until(100).foreach(x => println(x))`ã€‚`intWrapper(0).until(100)`æ˜¯`0 until 100`é€šè¿‡Implicit Resolutionæ‰€ç”Ÿäº§çš„ï¼Œæ¥ä¸‹æ¥çš„`foreach`æ˜¯ä¸åŒ…æ‹¬`yield`çš„`for`å¥æ³•ç³–çš„æœ€ç»ˆç»“æœã€‚å…³é”®è¯`yield`æ§åˆ¶å¥æ³•ç³–æ‰€ç”Ÿäº§çš„æœ€ç»ˆè°ƒç”¨çš„æ–¹æ³•ï¼šæ²¡æœ‰`yield`çš„è¯ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ–¹æ³•æ˜¯`foreach`ï¼ˆå› æ­¤ï¼Œ`for`è¡¨è¾¾å¼çš„è¿”å›ç±»å‹æ˜¯`Unit`ï¼Œè¿”å›å€¼æ˜¯`()`ï¼‰ï¼›æœ‰`yield`çš„è¯ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ–¹æ³•æ˜¯`map`ï¼ˆå› æ­¤ï¼Œ`for`è¡¨è¾¾å¼çš„è¿”å›å€¼æ˜¯`map`æ‰€è¿”å›çš„å€¼ï¼‰ã€‚

<table class="rouge-table">
<tr>
    <th>å¾ªç¯å¥æ³•ç³–</th>
    <th>ç¼–è¯‘çš„ç»“æœ</th>
</tr>
<tr>
    <td>
{% highlight Scala %}
for (i <- 0 until 100) yield i * 2
{% endhighlight %}
    </td>
    <td>
{% highlight Scala %}
(0 until 100).map(i => i * 2)
{% endhighlight %}
    </td>
</tr>
<tr>
    <td>
{% highlight Scala %}
for {
  i <- 0 until 100
  if i > 100
} yield i * 2
{% endhighlight %}
    </td>
    <td>
{% highlight Scala %}
(0 until 100)
  .withFilter(i => i > 100)
  .map(i => i * 2)
 
{% endhighlight %}
    </td>
</tr>
<tr>
    <td>
{% highlight Scala %}
for {
  a <- 0 until 10
  b <- 1 until 20
  if a < 5 && b > 1
} yield a * b
 
{% endhighlight %}
    </td>
    <td>
{% highlight Scala %}
(0 until 10)
  .flatMap { a => 
    (1 until 20)
      .withFilter(b => b > 1 && a < 5)
      .map(b => a * b)
  } 
{% endhighlight %}
    </td>
</tr>
</table>

ä¸Šé¢çš„è¡¨æ‰€ç¤ºçš„ç¼–è¯‘å™¨å¦‚ä½•å°†å¥æ³•ç³–ç¼–è¯‘éå¥æ³•ç³–çš„ä»£ç ï¼›å› ä¸ºæœ€ç»ˆç”Ÿäº§çš„å­—èŠ‚ç åªèƒ½ä¾é Javaè™šæ‹Ÿæœºè€Œæ‰§è¡Œï¼ŒScalaç¼–è¯‘å™¨æ‰€è¾“å‡ºçš„å­—èŠ‚ç åªèƒ½ä¾é æ™®éæ–¹æ³•è°ƒç”¨ã€‚*å¾ªç¯æœ¬èº«çš„ç®—æ³•å¿…é¡»å®ç°åœ¨`map`ã€`flatMap`ã€`foreach`ç­‰çš„æ–¹æ³•*ã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢`List.foreach`çš„è¿œå—å¾ˆæ˜æ˜¾åœ°è¡¨ç¤ºå¾ªç¯ï¼š

{% highlight Scala %}
@inline final override def foreach[U](f: A => U): Unit = {
  var these = this
  while (!these.isEmpty) {
    f(these.head)
    these = these.tail
  }
}
{% endhighlight %}

## `for`å¾ªç¯å¥æ³•ç³–çš„å¥½å¤„
å¥½åƒä¼ ç»Ÿçš„`for`å¾ªç¯æ‰€ç”Ÿäº§çš„æœºå™¨å‘½ä»¤å¾ˆç®€æ´ï¼›è¿™ç®€æ´ä¹ŸåŒ…æ‹¬Javaè™šæ‹Ÿæœºçš„å‘½ä»¤ã€‚åè€ŒScalaå¥½åƒä¸æ”¯æŒ`for`å¾ªç¯ï¼Œè€Œæ˜¯é€šè¿‡`while`å¾ªç¯Â·æ¥æ¨¡æ‹Ÿ`for`å¾ªç¯ã€‚ä¸è¿‡ï¼Œä»åº•å±‚å‘½ä»¤æ¥çœ‹ï¼Œ`for`å’Œ`while`æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼ŒäºŒè€…éƒ½æ˜¯é€šè¿‡åˆ¤æ–­ä¸€ä¸ªæ¡ä»¶æ¥ç®—å‡ºä¸“æŒ‘çš„ç›®çš„ã€‚é‚£ä¹ˆï¼Œè™½ç„¶ç†è®ºä¸Š`for`å’Œ`while`æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä½†æ˜¯Scalaçš„`for`å¼æ–¹æ³•ä¸€å®šæ¯”ä¼ ç»Ÿ`for`æ…¢å¾—å¤šï¼›æ¯”ä¼ ç»Ÿ`for`å¾ªç¯è¦é€šè¿‡æ›´å¤š`INVOKEVIRTUAL`å‘½ä»¤è€Œæ‰§è¡Œã€‚ç®€å•æ¥è¯´`INVOKEVIRTUAL`å‘½ä»¤ä¼šé€šè¿‡è™šæ‹Ÿæ–¹æ³•è¡¨æ‰¾åˆ°å…·ä½“æ–¹æ³•æ¥è°ƒç”¨ã€‚


[^1]: Haskellã€MLæŠŠè¯¥ç»“æ„å«åšä»£æ•°æ•°æ®ç»“æ„ï¼ŒHaskellã€MLéƒ½ç”¨æ¯”è¾ƒç®€æ´å¥æ³•æ¥å®šä¹‰ä»£æ•°æ•°æ®ç»“æ„ï¼Œå¯¹æ¯”ä¸€ä¸‹`sealed trait O[+A]; case class S[A](a: A) extends O[A]; case object N extends O[Nothing]`å’Œ`data O a = S a | N`ã€‚

<!--
ä¸”ååˆ†æ­£å¸¸ã€‚å¯¹å§ï¼Ÿå‘µå‘µï¼Œå¾—çœ‹æƒ…å†µï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œåœ¨å¤šçº¿æƒ…å†µä¸‹ä¸Šé¢çš„ä»£ç ä¼šå‡ºrace conditionã€‚è¯¥race conditionä¼šè¢«`numbers`æ•°ç»„åŒæ—¶å˜ã€è¯»å–å¼•èµ·çš„ã€‚é‚£ä¹ˆï¼ŒJavaåŒ…æ‹¬ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å…³é”®è¯ï¼Œå³`final`ã€‚å¤§å®¶éƒ½çŸ¥é“å®šä¹‰ä¸º`final`ä»£è¡¨ç€å˜é‡çš„å€¼æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆä¸å¯å˜çš„å˜é‡æ€ä¹ˆèƒ½è°ƒç”¨ç±»ä¼¼äº`add`çš„å‡½æ•°å‘¢ï¼Ÿå…¶å®ï¼Œåœ¨Javaï¼Œæ›´æ­£ç¡®åœ°è¯´JVMï¼ŒæŠŠ`final`å®šä¹‰ä¸ºâ€œæŒ‡é’ˆâ€æ˜¯ä¸å¯å˜çš„ï¼Œè€ŒæŒ‡é’ˆæ‰€æŒ‡çš„å®ä¾‹ä¸æ˜¯å› ä¸º`final`è€Œå—åˆ°ä»»ä½•é™åˆ¶çš„ã€‚

{% highlight Java linenos %}
final List<Integer> numbers    = Arrays.asList(1, 2, 3, 4, 5);
final List<Integer> filtered   = new ArrayList<>();
final List<Integer> mapped     = new ArrayList<>();
final List<Integer> flatMapped = new ArrayList<>();

// è™½ç„¶å®šä¹‰ä¸ºfinalï¼Œè¿˜èƒ½è°ƒç”¨`add`æ–¹æ³•
{% endhighlight %}

è¿™é‡Œè¦å¯¹æ¯”ä¸€ä¸‹C++æ‰€å¸¦æ¥çš„`const`ã€‚C++çš„`const`ç¡®å®æ˜¯ä»£è¡¨ç€å¸¸æ•°ã€ä¸å¯å˜çš„å€¼ã€‚

{% highlight Java linenos %}
const std::vector<int> numbers = { 1, 2, 3, 4, 5 };
numbers.push_back(6);   // ç¼–è¯‘æ—¶æŠ¥é”™ï¼š*const* std::vector<int> ä¸åŒ…å«ç€push_backå‡½æ•°
{% endhighlight %}

ä¸ºä»€ä¹ˆè¦è°ˆè°ˆ`final`ã€ä¸å¯å˜çš„å˜é‡å‘¢ï¼Ÿå› ä¸ºå¯ä»¥æŠŠ`final`ç›´æ¥ç¿»è¯‘åˆ°Scalaçš„`val`ã€‚æˆ‘å¼ºçƒˆæ¨èå¤§å®¶éƒ½å°½é‡ä½¿ç”¨`val`ï¼›é€šè¿‡`val`å¯ä»¥å†™æ›´å®¹æ˜“äº†è§£çš„ä»£ç ï¼Œä¸€æ—¦æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªå®šä¹‰ä¸º`val`çš„å˜é‡èµ‹å€¼å¥½ï¼Œå˜é‡çš„å€¼ä¸ä¼šè¢«æ”¹å˜çš„ã€‚æŠŠæ‰€æœ‰çš„å˜é‡éƒ½å®šä¹‰ä¸º`val`ï¼Œä¸€æ—¦æœ‰ä¸€å®šçš„å€¼ï¼Œæˆ‘ä»¬ç¡®å®šå®ƒçš„å€¼ä¸ä¼šå†å˜ã€‚å¯æƒœï¼Œåœ¨JVMè¯­è¨€ä¸­ï¼Œ`final`æœ¬èº«ä¸èƒ½ä¿è¯ä¸å¯å˜æ€§ã€‚å› ä¸ºä¸Šé¢æè¿°çš„`final`è§„åˆ™ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»ä¾èµ–ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚

é€šè¿‡æŸä¸€ä¸ªç®—æ³• ğ‘“ æŠŠæ¯ä¸€ä¸ªå…ƒç´ æ˜ å°„å¦å¤–ä¸€ä¸ªå…ƒç´ 

é€šè¿‡æŸä¸€ä¸ªç®—æ³• ğ‘“ æŠŠæ¯ä¸€ä¸ªå…ƒç´ æ˜ å°„å¦å¤–ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæŠŠè¿”å›çš„æ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ æ·»åŠ äºç»“æœ
-->
